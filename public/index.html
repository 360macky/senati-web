<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!-- <link rel="icon" href="<%= BASE_URL %>favicon.ico"> -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">
    <title><%= htmlWebpackPlugin.options.title %></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

<!-- jQuery and JS bundle w/ Popper.js -->

  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script>
      init();
      var table;
      function init(){
        getData();
        getCarreras();
      }
    
      function getData(){
        table = $('#lista_estudiantes').DataTable({
          pageLength: 10,
          responsive: true,
          processing: true,
          ajax: "https://senati.herokuapp.com/api/admin/crud/leer_estudiantes.php"
        });
      }
    
      function getCarreras(){
        $.getJSON("https://senati.herokuapp.com/api/admin/crud/leer_carreras.php", function(json){
                   $('#carrera').empty();
                   $('#carrera').append($('<option>').text());
                   $.each(json, function(i, obj){
                           $('#carrera').append($('<option>').text(obj.nom_carr).attr('value', obj.id_carr));
                   });
           });
      }
    
      function getDataById(id_s){
        parametros = {
          "id_s" : id_s
        }
        $.ajax({
              data: parametros,
              url:'https://senati.herokuapp.com/api/admin/crud/leer_uno.php',
              type:'POST',
              beforeSend:function(){},
              success:function(response){
                data = $.parseJSON(response);
                if(data.length > 0)
                {
                  $('#id').val(data[0]['id_s']);
                  $('#nombre').val(data[0]['nom_usu']);
                  $('#apellido').val(data[0]['ape_usu']);
                  $('#telefono').val(data[0]['telf_usu']);
                  $('#estado').val(data[0]['est_usu']);
                  $('#carrera').val(data[0]['id_carr']);
                  $('#estadotit').val(data[0]['est_tit']);
                }
             }
        });
      }
    
      function UpdateStudent(){
        id= $('#id').val();
        telefono = $('#telefono').val();
        carrera = $('#carrera').val();
        estado = $('#estado').val();
        estadotit = $('#estadotit').val();
        parametros = {
          "id_s":id, "telf_usu":telefono, "id_carr":carrera, "est_usu":estado, "est_tit":estadotit
        }
        $.ajax({
          data:parametros,
          url:'https://senati.herokuapp.com/api/admin/crud/actualizar.php',
          type:'POST',
          beforeSend:function(){},
          success:function(response){
            if(response == 1){
              table.ajax.reload();
              msg = '<div class="alert alert-success alert-dismissible fade show" role="alert">'
              +'Datos actualizados'
              +'<button type="button" class="close" data-dismiss="alert" aria-label="Close">'
              +'<span aria-hidden=true">&times;</span></button></div>'
            }else{
              msg = '<div class="alert alert-danger alert-dismissible fade show" role="alert">'
              +'No se pudo actualizar'
              +'<button type="button" class="close" data-dismiss="alert" aria-label="Close">'
              +'<span aria-hidden=true">&times;</span></button></div>'
            }
            $('#message').html(msg);
          }
        })
      }
    </script>
  </body>
</html>
